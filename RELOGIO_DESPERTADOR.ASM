    PROCESSOR   16f877A
	RADIX		DEC

;---------ARQUIVOS DE DEFINIÇÕES-----------

#INCLUDE <P16F877A.inc>
	__CONFIG	0X3F32

	ORG	0X00     ;VETOR DE INÍCIO
	GOTO INICIO  ;VAI PARA INÍCIO

	ORG 0X04     ;VETOR DE INTERRUPÇÃO
	GOTO INTER   ;VAI PARA INTERRUPÇÃO

;---------VARIÁVEIS----------
	ORG	0X20
TEMP	RES	2 ;REGISTRADOR TEMPORARIO/CONTA TEMPO DE ATRASO

USEG	RES 1 ;UNIDADE DE SEGUNDO
DSEG	RES 1 ;DEZENA DE SEGUNDO
UMIN	RES	1 ;UNIDADE DE MINUTO
DMIN	RES 1 ;DEZENA DE MINUTO
UHOR	RES	1 ;UNIDADE DE HORA
DHOR	RES	1 ;DEZENA DE HORA

USEGA	RES 1 ;UNIDADE DE SEGUNDO DO ALARME
DSEGA	RES 1 ;DEZENA DE SEGUNDO DO ALARME
UMINA	RES	1 ;UNIDADE DE MINUTO DO ALARME
DMINA	RES 1 ;DEZENA DE MINUTO DO ALARME
UHORA	RES	1 ;UNIDADE DE HORA DO ALARME
DHORA	RES	1 ;DEZENA DE HORA DO ALARME

DSEGRE	RES	2 ;REGISTRADOR EXTRA/MEIO SEGUNDO

W_TEMP	RES 1 ;SALVA W
S_TEMP	RES 1 ;SALVA STATUS

FLAGS	RES 1 ;0-PONTO,1-HORAMIN E MINSEG,2-ALARME,4-PONTO DE ALARME ATIVO

;---------INÍCIO DE PROGRAMA---------
INICIO
	BANKSEL	TRISD
	MOVLW	00000000B     ; TODOS OS PINOS DA PORTA C,D E A SÃO SAÍDAS
    MOVWF   TRISC
	MOVWF	TRISD
	MOVWF	TRISA
	MOVLW	11111111B     ; TODOS OS PINOS DA PORTA B SÃO ENTRADAS
	MOVWF	TRISB
	MOVLW	0X06
	MOVWF	ADCON1
	

	BANKSEL	PORTD         ;  PORTAS C,D E A NIVEL BAIXO
	MOVLW	00000000B
    MOVWF   PORTC
	MOVWF	PORTD
	MOVWF	PORTA
    MOVWF	PORTB

	BANKSEL T1CON
    BSF     T1CON,4       ; CONFIGURA TIMER1 COM PRESCALER = 1:8 (BIT T1CKPS1)
    BSF     T1CON,5       ; CONFIGURA TIMER1 COM PRESCALER = 1:8 (BIT T1CKPS1)
    BSF     T1CON,TMR1ON  ; LIGA O TIMER1

    BANKSEL PIE1
    BSF     PIE1,TMR1IE   ; HABILITA INTERRUPÇÃO DO TIMER1

    BANKSEL INTCON
    BSF     INTCON,PEIE   ; HABILITA INTERRUPÇÕES DOS PERIFÉRICOS
    BSF     INTCON,GIE    ; HABILITA INTERRUPÇÃO GLOBAL


;----------LIMPANDO E SETANDO VARIÁVEIS------------
	CLRF	USEG
	CLRF	DSEG
	CLRF	UMIN
	CLRF	DMIN
	CLRF	UHOR
	CLRF	DHOR
    CLRF	DSEGRE
	CLRF	TMR1L
	CLRF	TMR1H
	CLRF	FLAGS

	BSF		FLAGS,1

;---------ROTINA PRINCIPAL--------------
LOOP

;RB0
	BTFSC 	PORTB,0        ; SE BOTAO ATIVADO(0), PULA A PRÓXIMA INSTRUÇÃO; SE BOTÃO NÃO FOI APERTADO(1),VAI PARA RB3
	GOTO 	$+7            ; VAI PARA RB3
	BTFSS 	PORTB,0        ; BOTÃO AINDA PRESSIONADO(0)?
	GOTO 	$-1            ; SIM. VOLTA PARA A VERIFICAÇÃO
	

;AJUSTA O TEMPO
    MOVLW 	00000110B      ; CARREGA EM W O VALOR PARA CONFIGURAR PCLATH PARA CHAMAR A SUB-ROTINA DE AJUSTE
    MOVWF 	PCLATH         ; MOVE O VALOR DE W PARA O REGISTRADOR PCLATH (SELECIONA A PÁGINA DE MEMÓRIA DA SUB-ROTINA)
    CALL 	AJUSTE         ; CHAMA A SUB-ROTINA RESPONSÁVEL PELO AJUSTE DE HORAS E MINUTOS
    CLRF 	PCLATH         ; LIMPA PCLATH APÓS O RETORNO DA SUB-ROTINA


;RB3
	MOVLW	00000010B       ; CARREGA EM W O VALOR BINÁRIO PARA CONFIGURAR A TROCA DE MODO DE EXIBIÇÃO
	BTFSC	PORTB,3         ; SE BOTAO ATIVADO(0), PULA A PRÓXIMA INSTRUÇÃO; SE BOTÃO NÃO FOI APERTADO(1),VAI PARA RB5
	GOTO	$+4
	BTFSS	PORTB,3         ; BOTÃO AINDA PRESSIONADO(0)?
	GOTO	$-1             ; SIM. VOLTA PARA A VERIFICAÇÃO
	XORWF	FLAGS,F         ; INVERTE O BIT 1 DO REGISTRADOR FLAGS. ALTERNA O BIT DE MODO DE EXIBIÇÃO (EX: DE HORA:MINUTO PARA MINUTO:SEGUNDO)


;RB5
    BTFSC 	PORTB,5         ; SE BOTAO ATIVADO(0), PULA A PRÓXIMA INSTRUÇÃO; SE BOTÃO NÃO FOI APERTADO(1),VAI PARA RB4
    GOTO 	$+4     
    BTFSS 	PORTB,5         ; BOTÃO AINDA PRESSIONADO(0)?
    GOTO 	$-1             ; SIM. VOLTA PARA A VERIFICAÇÃO
    BSF FLAGS,2             ; SETA O BIT 2 DO REGISTRADOR FLAGS ( OU SEJA, ATIVA ALARME)

;RB4
    BTFSC 	PORTB,4         ; SE BOTAO ATIVADO(0), PULA A PRÓXIMA INSTRUÇÃO; SE BOTÃO NÃO FOI APERTADO(1),VAI PARA "CALL TIMER"
    GOTO 	$+4    
    BTFSS 	PORTB,4         ; BOTÃO AINDA PRESSIONADO(0)?
    GOTO 	$-1             ; SIM. VOLTA PARA A VERIFICAÇÃO
    BCF     PORTC,1         ; CLEAR O BIT 1 DA PORTA C ( OU SEJA, DESLIGA O BUZZER)

;CHAMA FUNÇAO PARA AUMENTAR TEMPO

	MOVLW	00000100B       ; CARREGA EM W O VALOR BINÁRIO PARA SELECIONAR A PÁGINA DE MEMÓRIA DA SUB-ROTINA TIMER
	MOVWF	PCLATH          ; MOVE O VALOR DE W PARA O REGISTRADOR PCLATH (SELECIONA A PÁGINA PARA CHAMADA DA SUB-ROTINA)
	CALL	TIMER           ; CHAMA A SUB-ROTINA TIMER RESPONSÁVEL PELO CONTROLE DE TEMPO (INCREMENTO DO RELÓGIO)
	CLRF	PCLATH          ; LIMPA O REGISTRADOR PCLATH APÓS O RETORNO DA SUB-ROTINA


;CHAMA FUNÇAO PARA EXIBIR DISPLAY

	MOVLW	00000010B       ; CARREGA EM W O VALOR BINÁRIO PARA SELECIONAR A PÁGINA DE MEMÓRIA DA SUB-ROTINA DISPLAY
	MOVWF	PCLATH          ; MOVE O VALOR DE W PARA O REGISTRADOR PCLATH (SELECIONA A PÁGINA PARA CHAMADA DA SUB-ROTINA)
	CALL	DISPLAY         ; CHAMA A SUB-ROTINA DISPLAY RESPONSÁVEL POR ATUALIZAR OS DÍGITOS NO DISPLAY DE 7 SEGMENTOS
	CLRF	PCLATH          ; LIMPA O REGISTRADOR PCLATH APÓS O RETORNO DA SUB-ROTINA


	GOTO	LOOP  

;-----------TEMPO QUE OS DISPLAYS PERMANECEM ACESSOS------------
ATRASO
    MOVLW   100
    MOVWF   TEMP
ATRASO_LOOP:
    NOP
    NOP
    DECFSZ  TEMP, F
    GOTO    ATRASO_LOOP
    RETURN


;-----------LIGA O DISPLAY-------------
	ORG	0X200
DISPLAY

    BCF     PORTA,2         ; DESLIGA DISPLAY 1
    BSF     PORTA,5         ; LIGA DISPLAY 4
    MOVLW   00000101B       ; CONFIGURA PCLATH PARA ACESSAR SUB-ROTINA EM OUTRA PÁGINA
    MOVWF   PCLATH          ; AJUSTA PCLATH PARA ACESSO À SUB-ROTINA BCD27SEG
    MOVF    UMIN,W          ; MOVE UNIDADE DE MINUTO PARA W
    BTFSS   FLAGS,1         ; SE BIT 1 DE FLAGS ESTIVER SETADO (MODO HH:MM), PULA PRÓXIMA INSTRUÇÃO
    MOVF    USEG,W          ; SENÃO, USA UNIDADE DE SEGUNDO (MODO MM:SS)
    CALL    BCD27SEG        ; CONVERTE DADO BINÁRIO PARA FORMATO DE 7 SEGMENTOS
    MOVWF   PORTD           ; ENVIA VALOR PARA O DISPLAY
    BTFSC   FLAGS,4         ; SE BIT 4 ESTIVER SETADO, ATIVA O PONTO DECIMAL (DP)
    BSF     PORTD,7         ; ATIVA SEGMENTO DP
    CLRF    PCLATH          ; LIMPA PCLATH APÓS A CHAMADA
    CALL    ATRASO          ; MANTÉM DISPLAY LIGADO POR UM TEMPO
    MOVLW   00000101B       ; PREPARA NOVAMENTE O PCLATH PARA PRÓXIMA CHAMADA
    MOVWF   PCLATH

    BCF     PORTA,5         ; DESLIGA DISPLAY 4
    BSF     PORTA,4         ; LIGA DISPLAY 3
    MOVF    DMIN,W          ; MOVE DEZENA DE MINUTO PARA W
    BTFSS   FLAGS,1         ; SE MODO HH:MM ESTIVER ATIVO, PULA PRÓXIMA
    MOVF    DSEG,W          ; SENÃO, USA DEZENA DE SEGUNDO
    CALL    BCD27SEG        ; CONVERTE PARA 7 SEGMENTOS
    MOVWF   PORTD           ; EXIBE NO DISPLAY
    CLRF    PCLATH          ; LIMPA PCLATH
    CALL    ATRASO          ; MANTÉM DISPLAY 3 ACESO
    MOVLW   00000101B       ; CONFIGURA PCLATH NOVAMENTE
    MOVWF   PCLATH

    BCF     PORTA,4         ; DESLIGA DISPLAY 3
    BSF     PORTA,3         ; LIGA DISPLAY 2
    MOVF    UHOR,W          ; MOVE UNIDADE DE HORA PARA W
    BTFSS   FLAGS,1         ; SE MODO HH:MM ATIVO, PULA PRÓXIMA
    MOVF    UMIN,W          ; SENÃO, MOSTRA UNIDADE DE MINUTO
    CALL    BCD27SEG        ; CONVERTE PARA 7 SEGMENTOS
    MOVWF   PORTD           ; ENVIA PARA O DISPLAY
    BTFSS   FLAGS,1         ; SE MODO HH:MM ATIVO, SEGUE PARA VERIFICAÇÃO DO PONTO
    GOTO    $+1             ; PULA AS INSTRUÇÕES DE CONTROLE DE DP SE NÃO FOR HH:MM
    BTFSC   FLAGS,0         ; SE BIT 0 ESTIVER ATIVO, LIGA DP
    BSF     PORTD,7         ; ATIVA SEGMENTO DP
    BTFSS   FLAGS,0         ; SE BIT 0 NÃO ESTIVER ATIVO
    BCF     PORTD,7         ; DESLIGA SEGMENTO DP
    CLRF    PCLATH          ; LIMPA PCLATH
    CALL    ATRASO          ; MANTÉM DISPLAY 2 LIGADO
    MOVLW   00000101B       ; CONFIGURA PCLATH PARA PRÓXIMA CHAMADA
    MOVWF   PCLATH


    BCF     PORTA,3         ; DESLIGA DISPLAY 2
    BSF     PORTA,2         ; LIGA DISPLAY 1
    MOVF    DHOR,W          ; MOVE DEZENA DE HORA PARA W
    BTFSS   FLAGS,1         ; SE BIT 1 DA FLAGS FOR SETADO, PULA A PRÓXIMA
    MOVF    DMIN,W          ; SENÃO, USA A DEZENA DOS MINUTOS
    CALL    BCD27SEG        ; CONVERTE PARA 7 SEGMENTOS
    MOVWF   PORTD           ; EXIBE NO DISPLAY
    CLRF    PCLATH          ; LIMPA PCLATH
    CALL    ATRASO          ; MANTÉM DISPLAY 1 ACESO
	
    RETURN



;-----------INTERRUPÇAO---------
	ORG	0X300
INTER
	MOVWF	W_TEMP          ; SALVA CONTEXTO
	SWAPF	STATUS,W
	MOVWF	S_TEMP

	MOVLW	3036/256        ; CARREGA A PARTE ALTA DO VALOR DE INICIALIZAÇÃO DO TIMER1 (RELOAD)
	MOVWF	TMR1H           ; ESCREVE NA PARTE ALTA DO TIMER1
	MOVLW	3036%256        ; CARREGA A PARTE BAIXA DO VALOR DE INICIALIZAÇÃO DO TIMER1 (RELOAD)
	MOVWF	TMR1L           ; ESCREVE NA PARTE BAIXA DO TIMER1

    BCF     PIR1, TMR1IF    ; LIMPA FLAG DE INTERR
    INCF    DSEGRE,F


    ; RESTAURA CONTEXTO
    SWAPF   S_TEMP, W
    MOVWF   STATUS
    SWAPF   W_TEMP, F
    SWAPF   W_TEMP, W

    RETFIE


;-----------CONTAGEM DO TEMPO------------
   Org 0x0400
TIMER:
   ; CONTADOR DE MEIO SEGUNDO
    BCF 	STATUS,C
    movf    DSEGRE, w
    xorlw   2
    btfss   STATUS, Z
    goto    $+5

    ; ZERAR MEIOSEG E INCREMENTAR USEG
    CLRF    DSEGRE
    INCF    USEG, F

    MOVLW	00000001B
	XORWF	FLAGS,F; FAZ O PONTO PISCAR
   
    MOVF    USEG, W
    XORLW   10
    BTFSS   STATUS, Z
    GOTO    $+3

    CLRF    USEG
    INCF    DSEG, F

    MOVF    DSEG, W
    XORLW   6
    BTFSS   STATUS, Z
    GOTO    $+3

    CLRF    DSEG
    INCF    UMIN, F
    MOVF    UMIN, W
    XORLW   10
    BTFSS   STATUS, Z
    GOTO    $+3

    CLRF    UMIN
    INCF    DMIN, F
    MOVF    DMIN, W
    XORLW   6
    BTFSS   STATUS, Z
    GOTO    $+3

    CLRF    DMIN
    INCF    UHOR, F
    MOVF    UHOR, W
    XORLW   10
    BTFSS   STATUS, Z
    GOTO    $+3

    CLRF    UHOR
    INCF    DHOR, F
    MOVF    DHOR,W
    XORLW   2                ; VERIFICA SE DHOR CHEGOU A 2
    BTFSS   STATUS,Z
    GOTO    $+7              ; SE NÃO, PULA A VERIFICAÇÃO A SEGUIR

    MOVF    UHOR,W
    XORLW   4                ; SE DHOR = 2, VERIFICA SE UHOR = 4 (24 HORAS)
    BTFSS   STATUS,Z
    GOTO    $+3

    CLRF    DHOR             ; ZERA DHOR
    CLRF    UHOR             ; ZERA UHOR

    ; VERIFICA SE O ALARME FOI ATIVADO (FLAG 2 SETADA)
    BTFSC   FLAGS,2          
    GOTO    ATIVA_ALARME     ; SE FLAG 2 SETADA, CHAMA ROTINA DO ALARME

RETURN 


;-------------BCD27SEG----------------
	ORG	0X500
BCD27SEG
	ANDLW	00001111B
	ADDWF	PCL,F
		   ;PGFEDCBA
	RETLW	00111111B ;0
	RETLW	00000110B ;1
	RETLW	01011011B ;2
	RETLW	01001111B ;3
	RETLW	01100110B ;4
	RETLW	01101101B ;5
	RETLW	01111101B ;6
	RETLW	00000111B ;7
	RETLW	01111111B ;8
	RETLW	01101111B ;9


;-------------AJUSTE------------
	ORG	0X600
	
AJUSTE
	BCF	T1CON,0		; DESLIGA TEMPORARIAMENTE O TIMER1 PARA AJUSTE MANUAL
	BSF	PORTA,2		; ATIVA O DISPLAY 1 PARA AJUSTE DA DEZENA DA HORA

#F	MOVLW	00000101		; CONFIGURA PCLATH PARA CHAMADA DE SUB-ROTINA EM OUTRA PÁGINA
	MOVWF	PCLATH
	BTFSC	PORTA,2
	MOVF	DHOR,W		; SE DISPLAY 1 ESTIVER ATIVO, MOSTRA DEZENA DA HORA
	BTFSC	PORTA,3
	MOVF	UHOR,W		; SE DISPLAY 2 ESTIVER ATIVO, MOSTRA UNIDADE DA HORA
	BTFSC	PORTA,4
	MOVF	DMIN,W		; SE DISPLAY 3 ESTIVER ATIVO, MOSTRA DEZENA DO MINUTO
	BTFSC	PORTA,5
	MOVF	UMIN,W		; SE DISPLAY 4 ESTIVER ATIVO, MOSTRA UNIDADE DO MINUTO
	CALL	BCD27SEG		; CONVERTE PARA 7 SEGMENTOS
	MOVWF	PORTD		; EXIBE NO DISPLAY
	MOVF	TEMP,W
	MOVWF	PCLATH

;--------RB2-INCREMENTA--------
	BTFSC	PORTB,2
	GOTO	$+11		; PULA O BLOCO SE RB2 NÃO FOR PRESSIONADO
	BTFSS	PORTB,2
	GOTO	$-1		; ESPERA O BOTÃO SER SOLTO (DEBOUNCE)
	BTFSC	PORTA,2
	INCF	DHOR,F		; INCREMENTA DEZENA DA HORA
	BTFSC	PORTA,3
	INCF	UHOR,F		; INCREMENTA UNIDADE DA HORA
	BTFSC	PORTA,4
	INCF	DMIN,F		; INCREMENTA DEZENA DO MINUTO
	BTFSC	PORTA,5
	INCF	UMIN,F		; INCREMENTA UNIDADE DO MINUTO

;--------RB1-DECREMENTA--------
	BTFSC	PORTB,1
	GOTO	$+11
	BTFSS	PORTB,1
	GOTO	$-1
	BTFSC	PORTA,2
	DECF	DHOR,F		; DECREMENTA DEZENA DA HORA
	BTFSC	PORTA,3
	DECF	UHOR,F		; DECREMENTA UNIDADE DA HORA
	BTFSC	PORTA,4
	DECF	DMIN,F		; DECREMENTA DEZENA DO MINUTO
	BTFSC	PORTA,5
	DECF	UMIN,F		; DECREMENTA UNIDADE DO MINUTO

;-----CONFERE VALOR DO TIMER (LIMITE SUPERIOR)---------
	MOVF	UMIN,W
	XORLW	10
	BTFSC	STATUS,Z
	CLRF	UMIN		; SE UMIN == 10, ZERA (SÓ VAI ATÉ 9)

	MOVF	DMIN,W
	XORLW	6
	BTFSC	STATUS,Z
	CLRF	DMIN		; SE DMIN == 6, ZERA (SÓ VAI ATÉ 5)

	MOVF	DHOR,W
	XORLW	3
	BTFSC	STATUS,Z
	CLRF	DHOR		; SE DHOR == 3, ZERA (SÓ VAI ATÉ 2)

	MOVF	DHOR,W
	XORLW	2
	BTFSS	STATUS,Z
	GOTO	$+6		; SE DHOR ? 2, PULA VERIFICAÇÃO
	MOVF	UHOR,W
	XORLW	4
	BTFSC	STATUS,Z
	CLRF	UHOR		; SE UHOR == 4 E DHOR == 2 ? PASSARIA DE 23, ZERA UHORA
	GOTO	$+5
	MOVF	UHOR,W
	XORLW	10
	BTFSC	STATUS,Z
	CLRF	UHOR		; SE UHOR == 10, ZERA

;---- CHECA VALORES INVÁLIDOS (-1 = 255) E CORRIGE --------
	MOVF	UMIN,W
	XORLW	0xFF
	BTFSS	STATUS,Z
	GOTO	$+3
	MOVLW	9
	MOVWF	UMIN		; SE UMIN = -1, VOLTA PARA 9

	MOVF	DMIN,W
	XORLW	0xFF
	BTFSS	STATUS,Z
	GOTO	$+3
	MOVLW	5
	MOVWF	DMIN		; SE DMIN = -1, VOLTA PARA 5

	MOVF	DHOR,W
	XORLW	0xFF
	BTFSS	STATUS,Z
	GOTO	$+3
	MOVLW	2
	MOVWF	DHOR		; SE DHOR = -1, VOLTA PARA 2

	MOVF	DHOR,W
	XORLW	2
	BTFSS	STATUS,Z
	GOTO	$+8		; SE DHOR ? 2, PULA VERIFICAÇÃO ADICIONAL
	MOVF	UHOR,W
	XORLW	0xFF
	BTFSS	STATUS,Z
	GOTO	$+3
	MOVLW	3
	MOVWF	UHOR		; SE UHOR = -1 E DHOR = 2, VOLTA PARA 3
	GOTO	$+7
	MOVF	UHOR,W
	XORLW	0xFF
	BTFSS	STATUS,Z
	GOTO	$+3
	MOVLW	9
	MOVWF	UHOR		; SE UHOR = -1 E DHOR ? 2, VOLTA PARA 9

;--------------RB0 - AVANÇA AJUSTE-----------------
	BTFSC	PORTB,0
	GOTO	$+24
	BTFSS	PORTB,0
	GOTO	$-1

;------ VERIFICA SE HORA É VÁLIDA (CASO UHOR=3 E DHOR=2)--------
	BTFSS	PORTA,2
	GOTO	$+9
	MOVF	DHOR,W
	XORLW	2
	BTFSS	STATUS,Z
	GOTO	$+5
	MOVF	UHOR,W
	SUBLW	4
	BTFSS	STATUS,C
	CLRF	UHOR		; SE UHOR > 3 E DHOR = 2, ZERA UHOR

;-----------------------------------
	BCF	    STATUS,C
	RLF  	PORTA,F		; RODA DISPLAY PARA PRÓXIMA POSIÇÃO

	BTFSS	PORTA,6
	GOTO	$+8
	BSF	    T1CON,0		; RELIGA O TIMER
	MOVLW	0
	MOVWF	DSEGRE
	MOVWF	USEG
	MOVWF	DSEG

	GOTO	AJUSTE_ALARME
	RETURN

	GOTO	#F

;-------AJUSTE PARA ALARME--------

AJUSTE_ALARME
    
    BCF		T1CON,0
	BSF		PORTA,2
	
#G	MOVLW	00000101
	MOVWF	PCLATH
	BTFSC	PORTA,2
	MOVF	DHORA,W
	BTFSC	PORTA,3
	MOVF	UHORA,W
	BTFSC	PORTA,4
	MOVF	DMINA,W
	BTFSC	PORTA,5
	MOVF	UMINA,W
	CALL	BCD27SEG
	MOVWF	PORTD
	MOVF	TEMP,W
	MOVWF	PCLATH

;--------RB2-INCREMENTA--------
	BTFSC	PORTB,2
	GOTO	$+11

	BTFSS	PORTB,2
	GOTO	$-1
	BTFSC	PORTA,2
	INCF	DHORA,F
	BTFSC	PORTA,3
	INCF	UHORA,F
	BTFSC	PORTA,4
	INCF	DMINA,F
	BTFSC	PORTA,5
	INCF	UMINA,F


;--------RB1-DECREMENTA--------
	BTFSC	PORTB,1
	GOTO	$+11

	BTFSS	PORTB,1
	GOTO	$-1
	BTFSC	PORTA,2
	DECF	DHORA,F
	BTFSC	PORTA,3
	DECF	UHORA,F
	BTFSC	PORTA,4
	DECF	DMINA,F
	BTFSC	PORTA,5
	DECF	UMINA,F


;-----CONFERE VALOR DO TIMER---------
	MOVF	UMINA,W
	XORLW	10
	BTFSC	STATUS,Z
	CLRF	UMINA

	MOVF	DMINA,W
	XORLW	6
	BTFSC	STATUS,Z
	CLRF	DMINA

	MOVF	DHORA,W
	XORLW	3
	BTFSC	STATUS,Z
	CLRF	DHORA

	MOVF	DHORA,W
	XORLW	2
	BTFSS	STATUS,Z
	GOTO	$+6
	
	MOVF	UHORA,W
	XORLW	4
	BTFSC	STATUS,Z
	CLRF	UHORA
	GOTO	$+5

	MOVF	UHORA,W
	XORLW	10
	BTFSC	STATUS,Z
	CLRF	UHORA

;---- CHECA VALORES INVÁLIDOS (-1 = 255) E CORRIGE --------
	MOVF	UMINA,W
	XORLW	11111111B;
	BTFSS	STATUS,Z
	GOTO	$+3
	MOVLW	9
	MOVWF	UMINA

	MOVF	DMINA,W
	XORLW	11111111B
	BTFSS	STATUS,Z
	GOTO	$+3
	MOVLW	5
	MOVWF	DMINA

	MOVF	DHORA,W
	XORLW	11111111B
	BTFSS	STATUS,Z
	GOTO	$+3
	MOVLW	2
	MOVWF	DHORA

	MOVF	DHORA,W
	XORLW	2
	BTFSS	STATUS,Z
	GOTO	$+8

	MOVF	UHORA,W
	XORLW	11111111B
	BTFSS	STATUS,Z
	GOTO	$+3
	MOVLW	3
	MOVWF	UHORA
	GOTO	$+7

	MOVF	UHORA,W
	XORLW	11111111B
	BTFSS	STATUS,Z
	GOTO 	$+3
	MOVLW	9
	MOVWF	UHORA

;--------------RB0-----------------
	BTFSC	PORTB,0
	GOTO	$+23
	BTFSS 	PORTB,0
	GOTO 	$-1

;VERIFICAÇÃO DA 24H FORMAT
	BTFSS	PORTA,2;
	GOTO	$+9
	MOVF	DHORA,W
	XORLW	2
	BTFSS	STATUS,Z
	GOTO	$+5
	MOVF	UHORA,W
	SUBLW	4
	BTFSS	STATUS,C
	CLRF	UHORA
;-----------------------------------

	BCF 	STATUS,C
	RLF 	PORTA,F

	BTFSS 	PORTA,6
	GOTO	$+7
	BSF		T1CON,0
	MOVLW	0
    MOVWF	DSEGRE+1
	MOVWF	USEGA
	MOVWF	DSEGA
	
	RETURN	
	
	GOTO 	#G


ATIVA_ALARME:

    BSF     FLAGS,4 ;ATIVA PONTO

     ;VERIFICA SEGUNDOS
    MOVF    DSEG, W
    XORWF   DSEGA, W
    BTFSS   STATUS, Z
    RETURN
    MOVF    USEG, W
    XORWF   USEGA, W
    BTFSS   STATUS, Z
    RETURN

    ; VERIFICA MINUTOS
    MOVF    DMIN, W
    XORWF   DMINA, W
    BTFSS   STATUS, Z
    RETURN
    MOVF    UMIN, W
    XORWF   UMINA, W
    BTFSS   STATUS, Z
    RETURN

    ; VERIFICA HORAS
    MOVF    DHOR, W
    XORWF   DHORA, W
    BTFSS   STATUS, Z
    RETURN
    MOVF    UHOR, W
    XORWF   UHORA, W
    BTFSS   STATUS, Z
    RETURN

    ; SE CHEGOU ATÉ AQUI, RELOGIO BATE COM ALARME
    ; ATIVA BUZZER
    BSF     PORTC,1

   
    RETURN
    

; ------------------------------

	END